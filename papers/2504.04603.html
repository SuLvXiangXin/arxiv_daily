<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Diffusion-Based Approximate MPC: Fast and Consistent Imitation of Multi-Modal Action Distributions - Robotics arXiv Daily</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../assets/styles.css"/>
  <link rel="stylesheet" href="../assets/detail.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"/>
</head>
<body>
  <div class="bg-orbit"></div>
  <header class="site-header">
    <div class="brand">
      <a href="../index.html" class="back-link">← 返回列表</a>
    </div>
  </header>
  <main class="detail-main">
    <article class="detail-card">
      <span class="detail-category">Robotics (cs.RO)</span>
      <h1>Diffusion-Based Approximate MPC: Fast and Consistent Imitation of Multi-Modal Action Distributions</h1>
      <div class="detail-meta">
        <span>arXiv: <a href="http://arxiv.org/abs/2504.04603" target="_blank" rel="noreferrer">2504.04603</a></span>
        <span>作者: Julbe, Pau Marquez, Nubert, Julian, Hose, Henrik, Trimpe, Sebastian, Kuchenbecker, Katherine J.</span>
        <span>日期: 2025/04/06</span>
      </div>
      <section class="detail-body">
        <h2>📝 详细解读</h2>
        <h2 id="研究背景与动机">研究背景与动机</h2>
<p>当前，通过模仿学习（IL）来近似模型预测控制（MPC）是一种主流方法，旨在避免在线求解昂贵的优化问题，实现快速控制。其中，最常见的方法是使用多层感知机（MLP）配合最小二乘（L2）回归来学习MPC控制器的映射。然而，当MPC问题是非线性、非凸的（例如包含障碍物约束）或数值求解器仅能找到局部最优解时，从状态到最优控制指令的映射可能是多模态的（集合值）。L2回归模型无法学习这种集合值分布，而只能学习目标分布的非最优均值，这可能导致近似控制器性能不佳甚至产生不可行解，严重限制了近似MPC（AMPC）的实际应用。</p>
<p>本文针对上述“AMPC无法有效处理多模态解分布”这一具体痛点，提出了使用扩散模型（Diffusion Models）来近似MPC多模态解分布的新视角。其核心思路是：利用扩散模型强大的分布建模能力，准确捕获MPC解的所有模态；并通过在去噪过程中引入梯度引导和早期停止噪声注入等策略，确保在高速闭环控制中能一致、平滑地选择同一模态。</p>
<h2 id="方法详解">方法详解</h2>
<p>本文提出的基于扩散的近似MPC（DAMPC）方法整体流程包括三个阶段：数据收集、扩散模型先验训练和推理采样。</p>
<p><img src="https://arxiv.org/html/2504.04603v3/x1.png" alt="方法框架"></p>
<blockquote>
<p><strong>图1</strong>：DAMPC方法整体框架。左下角展示了MPC优化问题产生的多模态动作分布。通过模仿学习训练扩散模型来近似该分布。方法优势包括：i) 早期停止噪声注入（ES），ii) 使用梯度引导（∇G）保证闭环一致性，iii) 在线选择最佳模态。</p>
</blockquote>
<p><strong>1. 数据收集</strong>：在仿真中运行MPC控制器收集数据集 $\mathcal{D}$。为了缓解分布偏移并探索吸引域，在执行MPC策略时添加了受控噪声（公式5），噪声标准差与当前指令幅值成比例。数据集中包含状态 $x_t$、期望设定点 $y_t^d$ 以及从局部最优求解器 $s$ 得到的（可能多模态的）最优控制序列 $u_{\cdot|t}^*$。不满意的局部极小解会从数据集中移除。</p>
<p><strong>2. 扩散模型训练</strong>：采用标准的去噪扩散概率模型（DDPM）框架。训练一个模型 $f_\theta^{x_0}$，其输入是经过 $i$ 步加噪的样本 $x_i$ 和步数索引 $i$，目标是预测干净的样本 $x_0$（即MPC的控制序列）。训练损失为简化后的变分下界（公式7）。</p>
<p><strong>3. 推理与采样改进</strong>：训练完成后，通过从标准高斯分布采样并逐步去噪来生成控制序列。本文针对高速闭环控制提出了三项关键改进：</p>
<ul>
<li><strong>梯度引导（∇G）保证一致性</strong>：为避免在连续控制步中随机切换不同模态导致抖动，提出使用梯度引导将采样分布条件依赖于上一步已执行的动作 $u_{t-1}^*$。通过贝叶斯规则（公式11,12），将引导项（公式13）加入去噪过程，使模型倾向于生成与上一时刻动作相近的解，模拟优化求解器中“热启动”的效果。</li>
<li><strong>早期停止噪声注入（ES）减少抖动</strong>：在去噪过程的后半段（高信噪比阶段）停止添加随机噪声（公式14），优先保证生成解的光滑性而非探索多样性，从而显著降低机械臂运动的加加速度（jerk）。</li>
<li><strong>并行采样与在线选择</strong>：利用GPU并行从扩散模型中采样 $L$ 个候选解。若系统状态完全已知，则可根据MPC成本和约束违反程度对这些解进行评分排序。若状态信息不完全，则采用基于密度的聚类（如欧氏距离），从样本数最多的簇（代表最可能的模态）中选取解，以丢弃低概率的异常解或训练数据中的不良局部极小解。</li>
</ul>
<p><strong>创新点</strong>：与现有L2回归AMPC相比，DAMPC的核心创新在于使用扩散模型这一生成模型来近似多模态分布，而非学习单点估计。与其它将扩散模型用于机器人高级规划的工作不同，本文专注于高速（高达1 kHz）、关节空间层面的低级动态控制，并提出了专为闭环控制设计的梯度引导和早期停止策略，确保了控制的一致性与平滑性。</p>
<p><img src="https://arxiv.org/html/2504.04603v3/x2.png" alt="梯度引导示意图"></p>
<blockquote>
<p><strong>图2</strong>：梯度引导（∇G）示意图。左图：无引导时，采样可能在两个解模态（紫色和橙色）间随机切换。右图：使用∇G后，采样被引导至上一步选择的模态（此处为橙色），保证了闭环一致性。</p>
</blockquote>
<h2 id="实验与结果">实验与结果</h2>
<p><strong>实验设置</strong>：使用一个7自由度KUKA LBR4+机械臂模型，任务是在关节空间中进行SE(3)末端执行器位姿跟踪，控制指令为关节速度。MPC预测 horizon N=20，时间间隔 Δt=0.1s。评估场景包括：1）仅自碰撞避免；2）在任务空间中央添加球形障碍物以引入非凸约束。在仿真和真实硬件上进行了实验，硬件控制频率为250 Hz。</p>
<p><strong>对比方法</strong>：</p>
<ul>
<li><strong>Baseline 1</strong>: 基于L2回归的最小二乘模型（LSM）。</li>
<li><strong>Baseline 2</strong>: 原始非线性MPC（使用IPOPT求解器在线优化）。</li>
<li><strong>本文方法</strong>: DAMPC，及其变体（带/不带梯度引导∇G和早期停止ES）。</li>
</ul>
<p><strong>关键实验结果</strong>：</p>
<ol>
<li><strong>多模态近似能力</strong>：在存在障碍物的非凸场景下，LSM无法学习多模态分布，其近似解的平均成功率仅为33.3%。而DAMPC能够成功捕获所有解模态，将成功率提升至77.8%，甚至超过了用于生成训练数据的教师MPC（成功率66.7%）。</li>
</ol>
<p><img src="https://arxiv.org/html/2504.04603v3/x3.png" alt="成功率对比"></p>
<blockquote>
<p><strong>图3</strong>：在带有中心障碍物的任务中，不同方法的成功率对比。DAMPC显著优于LSM，甚至超过了教师MPC。∇G和ES的引入进一步提升了性能。</p>
</blockquote>
<ol start="2">
<li><strong>控制性能与速度</strong>：在硬件实验中，DAMPC在250 Hz下运行稳定。相比在线求解MPC（仅能运行在10 Hz），DAMPC实现了超过70倍的加速。与LSM相比，DAMPC能更准确、平滑地跟踪轨迹，尤其在需要绕过障碍物时。</li>
</ol>
<p><img src="https://arxiv.org/html/2504.04603v3/x4.png" alt="硬件轨迹对比"></p>
<blockquote>
<p><strong>图4</strong>：硬件实验结果对比。左：DAMPC与LSM的末端执行器轨迹对比，DAMPC能更好地绕开障碍物（灰色球体）。右：DAMPC与原始MPC的关节速度命令对比，DAMPC在高速运行下仍能生成平滑的控制指令。</p>
</blockquote>
<ol start="3">
<li><strong>消融实验</strong>：<ul>
<li><strong>梯度引导（∇G）</strong>：显著提高了闭环一致性，减少了模态切换，使轨迹更平滑。</li>
<li><strong>早期停止噪声注入（ES）</strong>：有效降低了动作轨迹的加加速度（jerk），提升了控制品质。</li>
<li><strong>并行采样与选择</strong>：通过从多个候选解中择优，进一步提高了任务成功率和约束满足度。</li>
</ul>
</li>
</ol>
<p><img src="https://arxiv.org/html/2504.04603v3/x5.png" alt="消融研究"></p>
<blockquote>
<p><strong>图5</strong>：消融研究。(a) 不同组件对成功率的影响。(b) ∇G对闭环一致性的改善：无∇G时关节速度出现突变（模态切换），有∇G时速度平滑。(c) ES对平滑性的改善：启用ES后，加加速度（jerk）显著降低。</p>
</blockquote>
<h2 id="总结与启发">总结与启发</h2>
<p><strong>核心贡献</strong>：</p>
<ol>
<li>提出了一种新颖的基于扩散模型的AMPC框架，能够准确近似MPC的多模态动作分布，在性能上显著超越了传统的L2回归方法。</li>
<li>提出了一套用于高速闭环控制的策略，包括通过梯度引导确保控制一致性、通过早期停止噪声注入提高平滑性，以及通过并行采样与选择在线提升解的质量。</li>
<li>首次在真实机器人硬件上实现了基于扩散的AMPC，用于低级别、高速（250 Hz）控制，并展示了其优越性。</li>
</ol>
<p><strong>局限性</strong>：论文提到，扩散模型的训练和推理（尽管已加速）相比简单的LSM仍然需要更多的计算资源。此外，方法的性能上限依赖于用于生成演示数据的教师MPC的质量。</p>
<p><strong>启示</strong>：这项工作证明了生成模型（特别是扩散模型）在解决传统回归方法难以处理的机器人控制问题（如多模态分布）上的巨大潜力。其提出的针对闭环控制的改进策略（梯度引导、早期停止）为后续将生成模型应用于需要高频率、强一致性的实时控制系统提供了重要参考。未来研究可探索更轻量化的扩散模型或其蒸馏版本（如一致性模型），以在资源受限的平台上部署。</p>

      </section>
      <section class="detail-tldr">
        <h2>💡 一句话总结</h2>
        <p>本文针对传统基于L2回归的近似模型预测控制（AMPC）方法无法准确模仿多模态（集值）动作分布的问题，提出采用扩散模型来完整表征MPC优化产生的多模态解分布。关键技术包括：利用扩散模型在去噪过程中进行梯度引导，以在闭环中稳定选择同一模式；并行采样时结合原始MPC的成本与约束来在线选取更优模式。实验在7自由度机械臂上进行，控制器部署频率达250 Hz，相比在线求解MPC实现了超过70倍的速度提升，且成功率优于用于训练的数值优化方法。</p>
      </section>
      <div class="detail-actions">
        <a href="http://arxiv.org/abs/2504.04603" target="_blank" rel="noreferrer" class="btn">查看 arXiv 原文</a>
        <a href="../index.html" class="btn btn-outline">返回列表</a>
      </div>
    </article>
  </main>
  <footer class="site-footer">
    <span>数据来源：<a href="https://jiangranlv.github.io/robotics_arXiv_daily/" target="_blank">Robotics arXiv Daily</a></span>
    <span>由 GitHub Actions 自动更新 · AI 摘要仅供参考</span>
  </footer>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false}],throwOnError:false})"></script>
</body>
</html>